<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KodakBank ‚Äî Login</title>
  <style>
    *{box-sizing:border-box;font-family:system-ui,Segoe UI,Arial,sans-serif}
    body{margin:0;background:#f3f5f9;color:#1d2230}
    .center{min-height:100vh;display:grid;place-items:center;padding:24px}
    .card{width:100%;max-width:420px;background:#fff;padding:24px 22px;border-radius:14px;box-shadow:0 12px 32px rgba(0,0,0,.08)}
    h1{margin:0 0 6px;font-size:24px}
    .sub{margin:0 0 18px;color:#6b7280}
    label{display:block;margin-top:12px;font-size:14px;color:#374151}
    input{width:100%;margin-top:6px;padding:11px 12px;border:1px solid #d1d5db;border-radius:10px;outline:none;background:#fff}
    input:focus{border-color:#2563eb}
    .pwd{position:relative}
    .pwd button{position:absolute;right:8px;top:50%;transform:translateY(-50%);border:0;background:transparent;cursor:pointer;font-size:16px}
    .row{display:flex;align-items:center;justify-content:space-between;margin-top:10px;gap:8px}
    .chk{font-size:14px;color:#374151}
    .link{font-size:14px;color:#2563eb;text-decoration:none}
    .link:hover{text-decoration:underline}
    .btn{margin-top:16px;width:100%;padding:12px 14px;border:0;border-radius:10px;background:#2563eb;color:#fff;font-weight:600;cursor:pointer}
    .btn[disabled]{opacity:.7;cursor:not-allowed}
    .btn:hover{filter:brightness(.95)}
    .msg{min-height:18px;margin-top:10px;font-size:14px}
    .msg.error{color:#b91c1c}
    .msg.success{color:#065f46}
    .small{margin-top:10px;color:#6b7280;font-size:14px}
  </style>
</head>
<body>
  <main class="center">
    <div class="card">
      <h1>Welcome Back!</h1>
      <p class="sub">Please sign in to continue</p>

      <!-- no action attribute; we handle submit via JS -->
      <form id="loginForm" autocomplete="on" novalidate>
        <label for="loginEmail">Email</label>
        <input type="email" id="loginEmail" placeholder="you@example.com" required />

        <label for="loginPassword">Password</label>
        <div class="pwd">
          <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
          <button type="button" id="togglePwd" aria-label="Show password">üëÅÔ∏è</button>
        </div>

        <div class="row">
          <label class="chk"><input type="checkbox" id="rememberMe" /> Remember me</label>
          <a href="#" class="link" id="forgotLink">Forgot Password?</a>
        </div>

        <button class="btn" type="submit" id="loginBtn">Sign in</button>
        <p id="loginMsg" class="msg" role="status" aria-live="polite"></p>

        <p class="small">
          Don‚Äôt have an account?
          <a class="link" href="/signup.html">Register Now</a>
        </p>
      </form>
    </div>
  </main>

  <script>
    // ---- UI helpers ----
    const $ = (id) => document.getElementById(id);
    const emailInput = $('loginEmail');
    const passwordInput = $('loginPassword');
    const remember = $('rememberMe');
    const loginForm = $('loginForm');
    const loginBtn = $('loginBtn');
    const msg = $('loginMsg');

    // Show/hide password
    $('togglePwd').addEventListener('click', () => {
      const i = passwordInput;
      i.type = i.type === 'password' ? 'text' : 'password';
    });

    // Remember me (store email only)
    const KEY = 'kb_email';
    emailInput.value = localStorage.getItem(KEY) || '';
    remember.checked = !!emailInput.value;
    function syncRemember() {
      if (remember.checked) localStorage.setItem(KEY, (emailInput.value || '').trim());
      else localStorage.removeItem(KEY);
    }
    remember.addEventListener('change', syncRemember);
    emailInput.addEventListener('input', syncRemember);

    // Forgot (placeholder)
    $('forgotLink').addEventListener('click', (e) => {
      e.preventDefault();
      alert('Forgot Password flow will be added later.');
    });

    // Set message text + style
    function setMsg(text, type = '') {
      msg.className = 'msg ' + (type || '');
      msg.textContent = text;
    }

    // ---- Submit -> POST /api/login ----
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = (emailInput.value || '').trim();
      const password = passwordInput.value || '';

      // basic front-end validation
      if (!email || !password) {
        setMsg('Email and password are required.', 'error');
        return;
      }

      setMsg('Checking‚Ä¶');
      loginBtn.disabled = true;

      try {
        const res = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await res.json();
        if (!res.ok || !data.success) {
          throw new Error(data.error || 'Login failed');
        }

        // ‚úÖ Redirect to dashboard after a brief success message
        setMsg('Login successful. Redirecting‚Ä¶', 'success');
        window.location.href = '/dashboard.html';
      } catch (err) {
        setMsg(err.message || 'Something went wrong', 'error');
      } finally {
        loginBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
